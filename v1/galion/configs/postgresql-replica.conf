# ========================================
# PostgreSQL Replica Server Configuration
# For use when scaling to multiple database servers
# ========================================

# Include base configuration
include '/etc/postgresql/postgresql.conf'

# -----------------------------
# Standby Server Settings
# -----------------------------

# Enable hot standby (read-only queries on replica)
hot_standby = on

# Maximum delay before canceling queries
# Higher values = more replica lag tolerance
# Lower values = better data freshness
max_standby_streaming_delay = 30s
max_standby_archive_delay = 60s

# Enable feedback from standby to primary
hot_standby_feedback = on

# -----------------------------
# Recovery Settings
# -----------------------------

# Primary server connection info
# Set these in primary_conninfo
# primary_conninfo = 'host=10.0.0.1 port=5432 user=replicator password=xxx'

# Slot name on primary server
# primary_slot_name = 'replica1'

# Recovery target (for PITR)
# recovery_target_timeline = 'latest'

# -----------------------------
# Monitoring
# -----------------------------

# Log standby-related operations
log_recovery_conflict_waits = on

# -----------------------------
# Read-Only Configuration
# -----------------------------

# Ensure replica is read-only (safety measure)
# This prevents accidental writes to replica
default_transaction_read_only = on

# -----------------------------
# Performance
# -----------------------------

# Larger WAL receiver buffer for better streaming performance
wal_receiver_status_interval = 10s
wal_receiver_timeout = 60s
wal_retrieve_retry_interval = 5s

# -----------------------------
# Connection to Primary
# -----------------------------

# Example primary_conninfo (configure based on your setup)
# Uncomment and modify when setting up replica:

# primary_conninfo = 'host=10.0.0.1 port=5432 user=replicator password=REPLICATION_PASSWORD application_name=replica1'
# primary_slot_name = 'replica1'
# promote_trigger_file = '/tmp/promote_to_primary'

